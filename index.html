<!DOCTYPE html>
<html lang="en" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Universal AI Chat</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gemini: {
                            50: '#f0f4f8',
                            100: '#d9e2ec',
                            500: '#3b82f6', // Blue accent
                            600: '#2563eb',
                            900: '#102a43',
                        },
                        dark: {
                            bg: '#131314', // Gemini Dark BG
                            surface: '#1e1f20',
                            input: '#282a2c'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #4b5563; }
        
        /* Markdown Styles */
        .prose pre { background: #1e1e1e; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; color: #e5e7eb; }
        .prose code { font-family: monospace; background: rgba(0,0,0,0.1); padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.9em; }
        .dark .prose code { background: rgba(255,255,255,0.1); color: #e5e7eb; }
        .prose p { margin-bottom: 0.75rem; line-height: 1.6; }
        .prose ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 0.75rem; }
        .prose ol { list-style-type: decimal; padding-left: 1.5rem; margin-bottom: 0.75rem; }
        
        /* Mobile Layout Fixes */
        body { height: 100dvh; overflow: hidden; } /* dynamic viewport height */
        
        /* Loader */
        #loading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #ffffff; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Inter', sans-serif; font-weight: 500; color: #3b82f6;
        }
        .dark #loading { background: #131314; color: #60a5fa; }
    </style>
</head>
<body class="bg-white dark:bg-dark-bg text-gray-900 dark:text-gray-100 transition-colors duration-200">

    <div id="loading">
        <div class="flex flex-col items-center gap-4">
            <i class="ph ph-spinner animate-spin text-4xl"></i>
            <span>Initializing Interface...</span>
        </div>
    </div>

    <div id="app" class="flex h-full relative opacity-0 transition-opacity duration-500">
        
        <div id="sidebar-backdrop" class="fixed inset-0 bg-black/50 z-20 hidden lg:hidden glass" onclick="app.toggleSidebar()"></div>

        <aside id="sidebar" class="absolute lg:relative w-72 h-full bg-gray-50 dark:bg-dark-surface border-r border-gray-200 dark:border-gray-700 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 z-30 flex flex-col">
            
            <div class="p-4 flex items-center justify-between">
                <button onclick="app.createNewChat()" class="flex-1 flex items-center gap-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 px-4 py-3 rounded-xl transition-colors text-sm font-medium">
                    <i class="ph ph-plus text-lg"></i>
                    <span>New Chat</span>
                </button>
                <button onclick="app.toggleSidebar()" class="lg:hidden ml-2 p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i class="ph ph-x text-lg"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto px-2 space-y-1" id="chat-history-list">
                </div>

            <div class="p-4 border-t border-gray-200 dark:border-gray-700 space-y-2">
                <button onclick="app.openSettings()" class="w-full flex items-center gap-3 px-3 py-2 text-sm rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="ph ph-gear text-lg"></i>
                    Settings
                </button>
                <div class="flex items-center justify-between px-3 py-2 text-sm">
                    <span class="flex items-center gap-3">
                        <i class="ph ph-moon text-lg"></i>
                        Dark Mode
                    </span>
                    <button onclick="app.toggleTheme()" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-300 dark:bg-blue-600 transition-colors">
                        <span id="theme-toggle-dot" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1 dark:translate-x-6"></span>
                    </button>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col h-full relative w-full">
            
            <header class="flex lg:hidden items-center justify-between p-4 border-b border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-dark-bg/80 backdrop-blur">
                <button onclick="app.toggleSidebar()" class="p-2 -ml-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">
                    <i class="ph ph-list text-2xl text-gray-600 dark:text-gray-300"></i>
                </button>
                <span class="font-semibold text-gray-700 dark:text-gray-200">Gemini Clone</span>
                <div class="w-8"></div> </header>

            <div id="chat-container" class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth pb-32">
                <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center opacity-0 transition-opacity duration-300">
                    <div class="bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent text-5xl font-bold mb-4">Hello, Human</div>
                    <p class="text-gray-500 dark:text-gray-400 max-w-md">How can I help you today? Ensure you have set your API Key in settings.</p>
                </div>
                
                <div id="messages-list" class="max-w-3xl mx-auto space-y-6 hidden"></div>
            </div>

            <div class="w-full bg-gradient-to-t from-white via-white to-transparent dark:from-dark-bg dark:via-dark-bg p-4 md:pb-6 relative z-10">
                <div class="max-w-3xl mx-auto relative">
                    <textarea 
                        id="user-input" 
                        rows="1" 
                        placeholder="Message AI..." 
                        class="w-full bg-gray-100 dark:bg-dark-input border-0 rounded-3xl pl-5 pr-14 py-4 focus:ring-2 focus:ring-blue-500 resize-none max-h-48 overflow-y-auto shadow-sm text-gray-800 dark:text-gray-100 placeholder-gray-500 scrollbar-hide"
                        oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"
                        onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); app.sendMessage(); }"
                    ></textarea>
                    
                    <button 
                        id="send-btn"
                        onclick="app.sendMessage()" 
                        class="absolute right-2 bottom-2 p-2 rounded-full bg-blue-600 text-white hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center w-10 h-10 mb-0.5"
                    >
                        <i class="ph ph-paper-plane-right text-xl"></i>
                    </button>
                </div>
                <div class="text-center mt-2 text-xs text-gray-400">
                    AI can make mistakes. Check important info.
                </div>
            </div>
        </main>
    </div>

    <div id="settings-modal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white dark:bg-dark-surface w-full max-w-md rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-95 opacity-0" id="settings-content">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h2 class="text-xl font-semibold">Settings</h2>
                <button onclick="app.closeSettings()" class="text-gray-500 hover:text-gray-800 dark:hover:text-gray-200">
                    <i class="ph ph-x text-xl"></i>
                </button>
            </div>
            
            <div class="p-6 space-y-5">
                <div>
                    <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">OpenRouter API Key</label>
                    <input type="password" id="api-key-input" placeholder="sk-or-..." class="w-full bg-gray-50 dark:bg-dark-input border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                    <p class="text-xs text-gray-500 mt-1">Key is stored locally in your browser.</p>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Model ID</label>
                    <input type="text" id="model-input" value="deepseek/deepseek-r1:free" class="w-full bg-gray-50 dark:bg-dark-input border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                    <p class="text-xs text-gray-500 mt-1">Default: deepseek/deepseek-r1:free</p>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">System Prompt</label>
                    <textarea id="system-prompt-input" rows="3" class="w-full bg-gray-50 dark:bg-dark-input border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none resize-none" placeholder="You are a helpful assistant..."></textarea>
                </div>
            </div>

            <div class="p-6 bg-gray-50 dark:bg-dark-bg border-t border-gray-200 dark:border-gray-700 flex justify-end">
                <button onclick="app.saveSettings()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                    Save Changes
                </button>
            </div>
        </div>
    </div>

    <script>
        /**
         * UNIVERSAL AI CHAT - SINGLE FILE APP
         * No Build Tools | Vanilla JS | Tailwind | OpenRouter
         */

        const Utils = {
            generateId: () => Date.now().toString(36) + Math.random().toString(36).substr(2),
            escapeHtml: (str) => str.replace(/[&<>'"]/g, tag => ({
                '&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;'
            }[tag]))
        };

        const AppState = {
            chats: [],
            currentChatId: null,
            settings: {
                apiKey: '',
                model: 'deepseek/deepseek-r1:free',
                systemPrompt: 'You are a helpful AI assistant.',
                theme: 'light'
            },
            isGenerating: false
        };

        const app = {
            // --- Initialization ---
            init: () => {
                // Load from LocalStorage
                const savedState = localStorage.getItem('ai_chat_state');
                if (savedState) {
                    const parsed = JSON.parse(savedState);
                    AppState.chats = parsed.chats || [];
                    AppState.settings = { ...AppState.settings, ...parsed.settings };
                    AppState.currentChatId = parsed.currentChatId;
                }

                // Apply Theme
                app.applyTheme();

                // If no chats, create one
                if (AppState.chats.length === 0) {
                    app.createNewChat(true);
                } else if (!AppState.currentChatId || !AppState.chats.find(c => c.id === AppState.currentChatId)) {
                    AppState.currentChatId = AppState.chats[0].id;
                }

                // Initial Render
                app.renderSidebar();
                app.renderChat();
                
                // Remove Loader
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('app').classList.remove('opacity-0');
                    if(!AppState.settings.apiKey) app.openSettings();
                }, 500);
            },

            saveState: () => {
                localStorage.setItem('ai_chat_state', JSON.stringify({
                    chats: AppState.chats,
                    settings: AppState.settings,
                    currentChatId: AppState.currentChatId
                }));
            },

            // --- Theme Management ---
            toggleTheme: () => {
                AppState.settings.theme = AppState.settings.theme === 'light' ? 'dark' : 'light';
                app.applyTheme();
                app.saveState();
            },

            applyTheme: () => {
                const html = document.documentElement;
                if (AppState.settings.theme === 'dark') {
                    html.classList.add('dark');
                    document.getElementById('theme-toggle-dot').classList.add('translate-x-6');
                    document.getElementById('theme-toggle-dot').classList.remove('translate-x-1');
                } else {
                    html.classList.remove('dark');
                    document.getElementById('theme-toggle-dot').classList.remove('translate-x-6');
                    document.getElementById('theme-toggle-dot').classList.add('translate-x-1');
                }
            },

            // --- Sidebar / Navigation ---
            toggleSidebar: () => {
                const sidebar = document.getElementById('sidebar');
                const backdrop = document.getElementById('sidebar-backdrop');
                const isClosed = sidebar.classList.contains('-translate-x-full');
                
                if (isClosed) {
                    sidebar.classList.remove('-translate-x-full');
                    backdrop.classList.remove('hidden');
                } else {
                    sidebar.classList.add('-translate-x-full');
                    backdrop.classList.add('hidden');
                }
            },

            renderSidebar: () => {
                const list = document.getElementById('chat-history-list');
                list.innerHTML = '';

                // Sort chats by date (newest first)
                const sortedChats = [...AppState.chats].sort((a, b) => b.updatedAt - a.updatedAt);

                sortedChats.forEach(chat => {
                    const isActive = chat.id === AppState.currentChatId;
                    const el = document.createElement('div');
                    el.className = `group flex items-center justify-between p-3 rounded-lg cursor-pointer text-sm transition-colors ${
                        isActive 
                        ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium' 
                        : 'hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300'
                    }`;
                    
                    el.innerHTML = `
                        <div class="flex items-center gap-3 overflow-hidden" onclick="app.switchChat('${chat.id}')">
                            <i class="ph ph-chat-circle text-lg shrink-0"></i>
                            <span class="truncate">${Utils.escapeHtml(chat.title || 'New Chat')}</span>
                        </div>
                        <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity ${isActive ? 'opacity-100' : ''}">
                            <button onclick="event.stopPropagation(); app.renameChat('${chat.id}')" class="p-1 hover:text-blue-600"><i class="ph ph-pencil"></i></button>
                            <button onclick="event.stopPropagation(); app.deleteChat('${chat.id}')" class="p-1 hover:text-red-600"><i class="ph ph-trash"></i></button>
                        </div>
                    `;
                    list.appendChild(el);
                });
            },

            // --- Chat Logic ---
            createNewChat: (silent = false) => {
                const newChat = {
                    id: Utils.generateId(),
                    title: 'New Chat',
                    messages: [],
                    createdAt: Date.now(),
                    updatedAt: Date.now()
                };
                AppState.chats.unshift(newChat);
                AppState.currentChatId = newChat.id;
                app.saveState();
                if (!silent) {
                    app.renderSidebar();
                    app.renderChat();
                    // Close mobile sidebar if open
                    document.getElementById('sidebar').classList.add('-translate-x-full');
                    document.getElementById('sidebar-backdrop').classList.add('hidden');
                }
            },

            switchChat: (id) => {
                AppState.currentChatId = id;
                app.saveState();
                app.renderSidebar();
                app.renderChat();
                // Close mobile sidebar
                document.getElementById('sidebar').classList.add('-translate-x-full');
                document.getElementById('sidebar-backdrop').classList.add('hidden');
            },

            deleteChat: (id) => {
                if (confirm('Delete this chat?')) {
                    AppState.chats = AppState.chats.filter(c => c.id !== id);
                    if (AppState.currentChatId === id) {
                        AppState.currentChatId = AppState.chats.length > 0 ? AppState.chats[0].id : null;
                        if (!AppState.currentChatId) app.createNewChat(true);
                    }
                    app.saveState();
                    app.renderSidebar();
                    app.renderChat();
                }
            },

            renameChat: (id) => {
                const chat = AppState.chats.find(c => c.id === id);
                const newTitle = prompt('Enter chat name:', chat.title);
                if (newTitle) {
                    chat.title = newTitle;
                    app.saveState();
                    app.renderSidebar();
                }
            },

            renderChat: () => {
                const container = document.getElementById('messages-list');
                const welcome = document.getElementById('welcome-screen');
                const currentChat = AppState.chats.find(c => c.id === AppState.currentChatId);
                
                container.innerHTML = '';

                if (!currentChat || currentChat.messages.length === 0) {
                    container.classList.add('hidden');
                    welcome.classList.remove('hidden', 'opacity-0');
                    welcome.classList.add('opacity-100');
                    return;
                }

                welcome.classList.add('hidden');
                container.classList.remove('hidden');

                currentChat.messages.forEach(msg => {
                    const div = document.createElement('div');
                    const isUser = msg.role === 'user';
                    
                    div.className = `flex w-full ${isUser ? 'justify-end' : 'justify-start'}`;
                    
                    const contentHtml = isUser 
                        ? `<p class="whitespace-pre-wrap">${Utils.escapeHtml(msg.content)}</p>` 
                        : marked.parse(msg.content);

                    div.innerHTML = `
                        <div class="max-w-[85%] md:max-w-[75%] rounded-2xl px-5 py-3 shadow-sm ${
                            isUser 
                            ? 'bg-gray-100 dark:bg-dark-input text-gray-900 dark:text-gray-100 rounded-br-sm' 
                            : 'bg-transparent text-gray-900 dark:text-gray-100 rounded-bl-sm -ml-4'
                        }">
                            ${!isUser ? '<div class="flex items-center gap-2 mb-1 text-xs font-semibold text-blue-500 mb-2"><i class="ph ph-sparkle"></i> AI</div>' : ''}
                            <div class="prose dark:prose-invert text-sm md:text-base leading-relaxed break-words">
                                ${contentHtml}
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });

                app.scrollToBottom();
            },

            scrollToBottom: () => {
                const chatContainer = document.getElementById('chat-container');
                chatContainer.scrollTop = chatContainer.scrollHeight;
            },

            // --- Messaging & API ---
            sendMessage: async () => {
                if (AppState.isGenerating) return;
                
                const input = document.getElementById('user-input');
                const content = input.value.trim();
                
                if (!content) return;
                if (!AppState.settings.apiKey) {
                    alert('Please enter your OpenRouter API Key in settings.');
                    app.openSettings();
                    return;
                }

                // UI Updates
                input.value = '';
                input.style.height = 'auto';
                AppState.isGenerating = true;
                app.updateSendButton();

                // Add User Message
                const chat = AppState.chats.find(c => c.id === AppState.currentChatId);
                chat.messages.push({ role: 'user', content });
                
                // Auto-rename chat if it's the first message
                if (chat.messages.length === 1) {
                    chat.title = content.slice(0, 30) + (content.length > 30 ? '...' : '');
                    app.renderSidebar();
                }

                app.renderChat(); // Updates UI instantly

                // Add placeholder AI message
                chat.messages.push({ role: 'assistant', content: '' });
                const aiMsgIndex = chat.messages.length - 1;
                
                // Create a temporary streaming DOM element
                const container = document.getElementById('messages-list');
                const aiDiv = document.createElement('div');
                aiDiv.className = `flex w-full justify-start`;
                aiDiv.id = `streaming-msg`;
                aiDiv.innerHTML = `
                    <div class="max-w-[85%] md:max-w-[75%] rounded-2xl px-5 py-3 -ml-4">
                        <div class="flex items-center gap-2 mb-1 text-xs font-semibold text-blue-500 mb-2"><i class="ph ph-sparkle"></i> AI</div>
                        <div class="prose dark:prose-invert text-sm md:text-base leading-relaxed break-words">
                            <span class="inline-block w-2 h-4 bg-blue-500 animate-pulse"></span>
                        </div>
                    </div>
                `;
                container.appendChild(aiDiv);
                app.scrollToBottom();

                try {
                    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${AppState.settings.apiKey}`,
                            "Content-Type": "application/json",
                            "HTTP-Referer": window.location.href,
                        },
                        body: JSON.stringify({
                            model: AppState.settings.model,
                            messages: [
                                { role: "system", content: AppState.settings.systemPrompt },
                                ...chat.messages.slice(0, -1) // Exclude the empty placeholder
                            ],
                            stream: true
                        })
                    });

                    if (!response.ok) throw new Error(`API Error: ${response.status}`);

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder("utf-8");
                    let aiText = "";

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;

                        const chunk = decoder.decode(value, { stream: true });
                        const lines = chunk.split("\n");

                        for (const line of lines) {
                            if (line.startsWith("data: ") && line !== "data: [DONE]") {
                                try {
                                    const json = JSON.parse(line.substring(6));
                                    const delta = json.choices[0]?.delta?.content || "";
                                    aiText += delta;
                                    
                                    // Live Render: Update DOM content directly
                                    const proseDiv = aiDiv.querySelector('.prose');
                                    // We only parse markdown periodically or at end to save perf, 
                                    // but for "letter by letter" feel, raw text + cursor is safest during stream
                                    // Simple approach: Render marked for current total text
                                    proseDiv.innerHTML = marked.parse(aiText);
                                    
                                    app.scrollToBottom();
                                } catch (e) {
                                    console.error("Parse error", e);
                                }
                            }
                        }
                    }

                    // Finalize
                    chat.messages[aiMsgIndex].content = aiText;
                    chat.updatedAt = Date.now();
                    app.saveState();
                    app.renderSidebar(); // Update order

                } catch (error) {
                    chat.messages[aiMsgIndex].content = `**Error:** ${error.message}`;
                    app.saveState();
                    app.renderChat();
                } finally {
                    // Remove streaming ID and do full re-render to ensure syntax highlighting etc
                    document.getElementById('streaming-msg')?.remove();
                    app.renderChat();
                    AppState.isGenerating = false;
                    app.updateSendButton();
                }
            },

            updateSendButton: () => {
                const btn = document.getElementById('send-btn');
                const icon = btn.querySelector('i');
                if (AppState.isGenerating) {
                    btn.disabled = true;
                    icon.classList.remove('ph-paper-plane-right');
                    icon.classList.add('ph-spinner', 'animate-spin');
                } else {
                    btn.disabled = false;
                    icon.classList.remove('ph-spinner', 'animate-spin');
                    icon.classList.add('ph-paper-plane-right');
                }
            },

            // --- Settings Modal Logic ---
            openSettings: () => {
                const modal = document.getElementById('settings-modal');
                const content = document.getElementById('settings-content');
                
                // Populate fields
                document.getElementById('api-key-input').value = AppState.settings.apiKey;
                document.getElementById('model-input').value = AppState.settings.model;
                document.getElementById('system-prompt-input').value = AppState.settings.systemPrompt;

                modal.classList.remove('hidden');
                // Animation frame for transition
                requestAnimationFrame(() => {
                    content.classList.remove('scale-95', 'opacity-0');
                    content.classList.add('scale-100', 'opacity-100');
                });
            },

            closeSettings: () => {
                const modal = document.getElementById('settings-modal');
                const content = document.getElementById('settings-content');
                
                content.classList.remove('scale-100', 'opacity-100');
                content.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 200);
            },

            saveSettings: () => {
                AppState.settings.apiKey = document.getElementById('api-key-input').value.trim();
                AppState.settings.model = document.getElementById('model-input').value.trim() || 'deepseek/deepseek-r1:free';
                AppState.settings.systemPrompt = document.getElementById('system-prompt-input').value.trim();
                
                app.saveState();
                app.closeSettings();
            }
        };

        // Start App
        document.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
